<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gm.sample_project.mapper.ReviewMapper">
<insert id="addReview">
    INSERT INTO book_work_db.book_review
    (br_bi_seq, br_title, br_text, br_star, br_status)
    VALUES(#{br_bi_seq}, #{br_title}, #{br_text}, #{br_star}, #{br_status})
</insert>
<select id="getReviewList" resultType="com.gm.sample_project.data.ReviewVO">
    select br_seq, book_name, br_title, br_text, br_star, br_status, br_reg_dt, br_mod_dt from 
    (
    select a.*, b.bi_name as book_name
    from book_review a left outer join book_info b 
    on a.br_bi_seq = b.bi_seq 
    ) c
    <if test="type == 'book_name'">
        where book_name like #{keyword}
        </if>
        <!-- <if test="type == 'review_writer'">
        where  like #{keyword}
        </if> -->
    order by br_seq desc
    limit 10 offset 0
</select>
<select id="getReviewCnt" resultType="java.lang.Integer">
    select count(*) from 
    (
    select a.*, b.bi_name as book_name
    from book_review a left outer join book_info b 
    on a.br_bi_seq = b.bi_seq 
    ) c
    <if test="type == 'book_name'">
    where book_name like #{keyword}
    </if>
        <!-- <if test="type == 'review_writer'">
        where  like #{keyword}
        </if> -->
</select>
<delete id="deleteReview">
    delete from book_review where br_seq=#{seq}
</delete>
<select id="getReviewInfoBySeq" resultType="com.gm.sample_project.data.ReviewVO">
    SELECT br_seq, br_bi_seq, br_title, br_text, br_star, br_status, bi_name as book_name
    FROM book_review a left outer join book_info b
    on a.br_bi_seq = b.bi_seq
    where br_seq=#{seq}
</select>
<update id="updateReviewInfo">
    update book_review set
    <!--
            br_bi_seq = #{br_bi_seq}, 
            book_name=#{book_name},
            br_title = #{br_title}, 
            br_text= #{br_text}, 
            br_star=#{br_star},
        -->
            br_status = #{br_status},  br_mod_dt = NOW()
    where br_seq = #{br_seq}
</update>    

</mapper>   